<mat-card class="detail-card" *ngIf="issuance">
    <div class="row">
        <div class="col-xs-8 card-title">
            <img src="../../../../assets/images/navigate_back.png" class="navigate-back" (click)="navigateBack()"> Offer
            Details
        </div>
        <div class="col-xs-4 card-state" [ngStyle]="{'color':issuance.state <= 3 ? '#8bc34a' : 'grey'}">
            <span class="card-state-indicator">&#8226;</span>
            {{issuance.getIssuanceState()}}
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 detail-value detail-label">
            {{currencyService.currency}} value
        </div>
    </div>

    <div class="row detail-row">
        <div class="col-xs-3 card-label">Input</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{issuance.inputAmount | tokenValue:inputToken | number: '1.0-4'}} {{inputToken}}
            </div>
        </div>

        <div class="col-xs-3 detail-value">
            {{currencyService.getCurrencySymbol()}} {{ convertedInputValue | async | number: '1.0-2'}}
        </div>
    </div>

    <div class="row detail-row">
        <div class="col-xs-3 card-label">Output</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{issuance.outputAmount | tokenValue:outputToken | number: '1.0-4'}} {{outputToken}}
            </div>
        </div>

        <div class="col-xs-3 detail-value">
            {{currencyService.getCurrencySymbol()}} {{ convertedOutputValue | async | number: '1.0-2'}}
        </div>
    </div>

    <div class="row detail-row" *ngIf="issuance.makerAddress.toLowerCase() == nutsPlatformService.currentAccount.toLowerCase() || issuance.takerAddress.toLowerCase() == nutsPlatformService.currentAccount.toLowerCase()">
        <div class="col-xs-3 card-label">Role</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{issuance.makerAddress.toLowerCase() == nutsPlatformService.currentAccount.toLowerCase() ? 'maker' : 'taker'}}
            </div>
        </div>

        <div class="col-xs-2"></div>
    </div>

    <div class="row detail-row">
        <div class="col-xs-3 card-label">Duration</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{issuance.duration}} days
            </div>
        </div>

        <div class="col-xs-2"></div>
    </div>

    <div class="row detail-row" *ngIf="issuance.engagementTimestamp">
        <div class="col-xs-3 card-label">Engaged</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{issuance.engagementTimestamp * 1000 | date: 'MM-dd-yyyy'}}
            </div>
        </div>

        <div class="col-xs-2"></div>
    </div>

    <div class="row detail-row" *ngIf="issuance.state <= 3">
        <div class="col-xs-3 card-label">Due Date</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{ (issuance.state <= 2? issuance.engagementDueTimestamp * 1000 : issuance.issuanceDueTimestamp * 1000) | date: 'MM-dd-yyyy'}}
            </div>
        </div>

        <div class="col-xs-2"></div>
    </div>

    <div class="row" *ngIf="issuance.state == 2 && issuance.makerAddress.toLowerCase() != nutsPlatformService.currentAccount.toLowerCase()">
        <div class="col-xs-12 action-row">
            <button mat-raised-button color="primary"
                [ngClass]="{'engage-button': true, 'valid': outputSufficient}"
                (click)="engageIssuance()">Engage</button>
        </div>
    </div>
    <div class="row" *ngIf="issuance.state == 2 && issuance.makerAddress.toLowerCase() != nutsPlatformService.currentAccount.toLowerCase()">
        <div
            [ngClass]="{'col-xs-12': true, 'hidden': outputSufficient}">
            <span style="color: red;">Insufficient balance</span>
            (<span style="color: blue;">
                <app-account-balance [instrument]="'swap'" [selectedToken]="outputToken"
                    (balanceUpdated)="onOutputTokenBalanceUpdated($event)">
                </app-account-balance>
                {{outputToken}}
            </span> available)
            <a class="deposit-button" [routerLink]="['/instrument/swap/account']" [queryParams]="{ token: outputToken}">Deposit</a>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 action-row"
            *ngIf="issuance.state == 2 && issuance.makerAddress.toLowerCase() == nutsPlatformService.currentAccount.toLowerCase()">
            <button mat-stroked-button color="primary" class="close-button" (click)="cancelIssuance()">
                Close Position
            </button>
        </div>
    </div>
</mat-card>

<div class="container transaction-history-container">
    <div class="row">
        <div class="col-xs-12 transaction-title">
            Transaction History
        </div>
    </div>

    <div *ngFor="let transaction of transactions; let i = index" [ngClass]="{'odd': i % 2 == 0, 'row': true, 'transaction-container': true}">
        <div class="col-xs-3 transaction-content transaction-action">{{transaction.action}}</div>
        <div class="col-xs-5 transaction-content transaction-from-to">
            <div class="transaction-from">
                <img src="../../../../assets/images/Maker_AC.png" alt="Maker A/C" class="transaction-wallet"
                    *ngIf="transaction.fromWallet == 'A/C' && transaction.fromRole == 'Maker'">
                <img src="../../../../assets/images/Maker_Position.png" alt="Maker Position" class="transaction-wallet"
                    *ngIf="transaction.fromWallet == 'Position' && transaction.fromRole == 'Maker'">
                <img src="../../../../assets/images/Taker_AC.png" alt="Taker A/C" class="transaction-wallet"
                    *ngIf="transaction.fromWallet == 'A/C' && transaction.fromRole == 'Taker'">
                <img src="../../../../assets/images/Taker_Position.png" alt="Maker Position" class="transaction-wallet"
                    *ngIf="transaction.fromWallet == 'Position' && transaction.fromRole == 'Taker'">
                <img src="../../../../assets/images/Custodian_AC.png" alt="Custodian A/C" class="transaction-wallet"
                    *ngIf="transaction.fromWallet == 'A/C' && transaction.fromRole == 'Custodian'">
                <img src="../../../../assets/images/Custodian_Position.png" alt="Custodian Position" class="transaction-wallet"
                    *ngIf="transaction.fromWallet == 'Position' && transaction.fromRole == 'Custodian'">
            </div>
            <span class="transaction-direction">â‡’</span>
            <div class="transaction-to">
                <img src="../../../../assets/images/Maker_AC.png" alt="Maker A/C" class="transaction-wallet"
                    *ngIf="transaction.toWallet == 'A/C' && transaction.toRole == 'Maker'">
                <img src="../../../../assets/images/Maker_Position.png" alt="Maker Position" class="transaction-wallet"
                    *ngIf="transaction.toWallet == 'Position' && transaction.toRole == 'Maker'">
                <img src="../../../../assets/images/Taker_AC.png" alt="Taker A/C" class="transaction-wallet"
                    *ngIf="transaction.toWallet == 'A/C' && transaction.toRole == 'Taker'">
                <img src="../../../../assets/images/Taker_Position.png" alt="Maker Position" class="transaction-wallet"
                    *ngIf="transaction.toWallet == 'Position' && transaction.toRole == 'Taker'">
                <img src="../../../../assets/images/Custodian_AC.png" alt="Custodian A/C" class="transaction-wallet"
                    *ngIf="transaction.toWallet == 'A/C' && transaction.toRole == 'Custodian'">
                <img src="../../../../assets/images/Custodian_Position.png" alt="Custodian Position" class="transaction-wallet"
                    *ngIf="transaction.toWallet == 'Position' && transaction.toRole == 'Custodian'">
            </div>
        </div>
        <div class="col-xs-2 transaction-content transaction-amount">
            {{transaction.amount | tokenValue:(transaction.token) | number: '1.0-4'}} {{transaction.token}}
        </div>
        <div class="col-xs-2 transaction-content transaction-date">
            <app-block-timestamp [blockNumber]="transaction.blockNumber" [showTimestamp]="true" [align]="'right'"></app-block-timestamp>
        </div>
    </div>

    <hr class="transaction-divider"/>

    <div class="row transaction-notation">
        <img src="../../../../assets/images/AC.png" alt="A/C" class="transaction-notation-image">
        <img src="../../../../assets/images/Position.png" alt="Position" class="transaction-notation-image">
        <img src="../../../../assets/images/Maker.png" alt="Maker" class="transaction-notation-image">
        <img src="../../../../assets/images/Taker.png" alt="Taker" class="transaction-notation-image">
        <img src="../../../../assets/images/Custodian.png" alt="Custodian" class="transaction-notation-image">
    </div>
</div>