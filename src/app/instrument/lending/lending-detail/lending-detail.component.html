<mat-card class="detail-card" *ngIf="issuance">
    <div class="row">
        <div class="col-xs-8 card-title">
            <img src="../../../../assets/images/navigate_back.png" class="navigate-back" (click)="navigateBack()">
            <span i18n>Offer Details</span>
        </div>
        <div class="col-xs-4 card-state" [ngStyle]="{'color':issuance.state <= 3 ? '#8bc34a' : 'grey'}">
            <span class="card-state-indicator">&#8226;</span>
            <span i18n>
                {issuance.getIssuanceState(), select, Engageable{Engageable} Engaged{Engaged} Cancelled{Cancelled} Expired{Expired} Completed{Completed} Delinquent{Delinquent} other{Unknown}}
            </span>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 detail-value detail-label">
            {{currencyService.currency}} <span i18n>value</span>
        </div>
    </div>

    <div class="row detail-row">
        <div class="col-xs-3 card-label" i18n>Principal</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{issuance.lendingAmount | tokenValue:lendingToken | number: '1.0-4'}} {{lendingToken}}
            </div>
        </div>

        <div class="col-xs-3 detail-value">
            {{currencyService.getCurrencySymbol()}} {{ convertedLendingValue | async | number: '1.0-2'}}
        </div>
    </div>

    <div class="row detail-row">
        <div class="col-xs-3 card-label" i18n>Collateral</div>

        <div class="col-xs-6">
            <div class="value-row">
                <div class="value-notation" i18n>
                    required
                </div>
                <div class="value-content">
                    {{ collateralValue | tokenValue:collateralToken | number: '1.0-4' }} {{collateralToken}}
                </div>
            </div>
            <div class="value-row">
                <div class="value-notation" i18n>
                    ratio
                </div>
                <div class="value-content">
                    {{issuance.collateralRatio / 100}} %
                </div>
            </div>
        </div>

        <div class="col-xs-3 detail-value">
            {{currencyService.getCurrencySymbol()}} {{ convertedCollateralValue | async | number: '1.0-2' }}
        </div>
    </div>

    <div class="row detail-row">
        <div class="col-xs-3 card-label" i18n>Interest</div>

        <div class="col-xs-6">
            <div class="value-row">
                <div class="value-notation" i18n>
                    per day
                </div>
                <div class="value-content">
                    {{ (issuance.lendingAmount * issuance.interestRate / 1000000) | tokenValue:lendingToken | number: '1.0-6' }} {{lendingToken}}
                </div>
            </div>
            <div class="value-row">
                <div class="value-notation" i18n>
                    total
                </div>
                <div class="value-content">
                    {{ (issuance.lendingAmount * issuance.interestRate * issuance.tenorDays / 1000000) | tokenValue:lendingToken | number: '1.0-4' }} {{lendingToken}}
                </div>
            </div>
        </div>

        <div class="col-xs-3">
            <div class="detail-value">
                {{currencyService.getCurrencySymbol()}} {{ convertedPerDayInterestValue | async | number: '1.0-4' }}
            </div>
            <div class="detail-value">
                {{currencyService.getCurrencySymbol()}} {{ convertedTotalInterestValue | async | number: '1.0-2' }}
            </div>
        </div>
    </div>

    <div class="row detail-row" *ngIf="issuance.getUserRole(currentAccount) != 'other'">
        <div class="col-xs-3 card-label" i18n>Role</div>

        <div class="col-xs-6">
            <div class="value-content" i18n>
                {issuance.getUserRole(currentAccount), select, maker{maker} taker{taker}}
            </div>
        </div>

        <div class="col-xs-2"></div>
    </div>

    <div class="row detail-row">
        <div class="col-xs-3 card-label" i18n>Tenor</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{issuance.tenorDays}} <span i18n>days</span>
            </div>
        </div>

        <div class="col-xs-2"></div>
    </div>

    <div class="row detail-row" *ngIf="issuance.engagementTimestamp > 0">
        <div class="col-xs-3 card-label" i18n>Engaged</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{issuance.engagementTimestamp * 1000 | date: 'MM-dd-yyyy'}}
            </div>
        </div>

        <div class="col-xs-2"></div>
    </div>

    <div class="row detail-row" *ngIf="issuance.state <= 3">
        <div class="col-xs-3 card-label" i18n>Due Date</div>

        <div class="col-xs-6">
            <div class="value-content">
                {{ (issuance.state <= 2? issuance.engagementDueTimestamp * 1000 : issuance.issuanceDueTimestamp * 1000) | date: 'MM-dd-yyyy'}}
            </div>
        </div>

        <div class="col-xs-2"></div>
    </div>

    <div class="row" *ngIf="issuance.state == 2 && issuance.getUserRole(currentAccount) != 'maker'">
        <div class="col-xs-12 action-row">
            <button mat-raised-button color="primary"
                [ngClass]="{'engage-button': true, 'valid': collateralSufficient}"
                (click)="engageIssuance()" i18n>Engage</button>
        </div>
    </div>
    <div class="row" *ngIf="issuance.state == 2 && issuance.getUserRole(currentAccount) != 'maker'">
        <div
            [ngClass]="{'col-xs-12': true, 'hidden': collateralSufficient}">
            <span style="color: red;" i18n>Insufficient balance</span>
            (<span style="color: blue;">
                <app-account-balance [instrument]="'lending'" [tokenAddress]="collateralToken.tokenAddress"
                    (balanceUpdated)="onCollateralTokenBalanceUpdated($event)">
                </app-account-balance>
                {{collateralToken}}
            </span> 
            <span i18n>available</span>)
            <a class="deposit-button" routerLink="../../account" [queryParams]="{ tokenAddress: collateralToken.tokenAddress }" i18n>Deposit</a>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 action-row"
            *ngIf="issuance.state == 3 && issuance.getUserRole(currentAccount) == 'taker'">
            <button mat-raised-button color="primary"
                [ngClass]="{'repay-button': true, 'valid': principalSufficient}"
                (click)="repayIssuance()" i18n>Repay</button>
        </div>
    </div>

    <div class="row" *ngIf="issuance.state == 3 && issuance.getUserRole(currentAccount) == 'taker'">
        <div
            [ngClass]="{'col-xs-12': true, 'hidden': principalSufficient}">
            <span style="color: red;" i18n>Insufficient balance</span>
            (<span style="color: blue;">
                <app-account-balance [instrument]="'lending'" [tokenAddress]="lendingToken.tokenAddress"
                    (balanceUpdated)="onPrincipalTokenBalanceUpdated($event)">
                </app-account-balance>
                {{lendingToken}}
            </span> 
            <span i18n>available</span>)
            <a class="deposit-button" routerLink="../../account" [queryParams]="{ tokenAddress: lendingToken.tokenAddress }" i18n>Deposit</a>
        </div>
    </div>

    <div class="row">
        <div class="col-xs-12 action-row"
            *ngIf="issuance.state == 2 && issuance.getUserRole(currentAccount) == 'maker'">
            <button mat-stroked-button color="primary" class="close-button" (click)="cancelIssuance()" i18n>
                Close Position
            </button>
        </div>
    </div>
</mat-card>